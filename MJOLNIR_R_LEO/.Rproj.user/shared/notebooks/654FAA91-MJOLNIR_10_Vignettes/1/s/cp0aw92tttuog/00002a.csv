"0","df_V <- d %>%"
"0","  # We gather all the result of all the vignette under the same variables"
"0","  gather(vignette_name, "
"0","         vignette_result, "
"0","         d %>% colnames() %>% str_detect(""^V[1-4].[0-9](_[A-Z]|)_Judge(Other|Self)_[0-9]$"") %>% which()) %>%"
"0","  # we get rid off the NA in vignette results (which happens because there is a variable for each race name even though participants have answered according to only one race)"
"0","  filter(!(is.na(vignette_result))) %>%"
"0","  # we create variables from the name to get the vignet number, the race of the name, if it's an Update or not and what's the Question"
"0","  mutate(V_Number=vignette_name %>% str_extract(""[0-9]""),"
"0","         V_Racename=vignette_name %>% str_extract(""[WIBC]""),"
"0","         V_Update=vignette_name %>% str_detect(""^V[0-9].2""),"
"0","         V_Question=vignette_name %>% str_extract(""Judge(Other|Self)_[0-9]$""))"
"0",""
"0","# We now have to complete the race name for the Update because they do not have the race of the name in the name of the variable (ex: V1.2_JudgeOther_1 and not V1.1_W_JudgeOther_1)"
"0","df_V <- df_V %>% "
"0","  # we select the rows that do not have a Racename (typically the Updates)"
"0","  filter(is.na(V_Racename)) %>%"
"0","  # we create a unique ID for each of the four vignette based on the vignette number and the participant ID"
"0","  mutate(IDD = paste0(ID, '_', V_Number)) %>%"
"0","  select(IDD, V_Update, V_Racename) %>%"
"0","  # we join the database of the lines without Racenames with those with race names according to the uniaue ID of the vignette, so that we have the race name for each vignette for each participants"
"0","  inner_join(df_V %>% "
"0","               filter(!(is.na(V_Racename))) %>%"
"0","               mutate(IDD = paste0(ID, '_', V_Number)) %>%"
"0","               select(IDD, V_Update, V_Racename),"
"0","               by=""IDD"") %>%"
"0","  # we gather the information and create a new unique ID for each vignette, Update and participants so that we have the race of the name according to the participants ID, Vignette number and Update or not"
"0","  gather(nu, V_Update, c(2,4)) %>%"
"0","  select(IDD, V_Racename.y, V_Update) %>%"
"0","  mutate(IDD = paste0(IDD, ""_"", V_Update),"
"0","         V_Racenamef = V_Racename.y) %>%"
"0","  select(IDD, V_Racenamef) %>%"
"0","  # we get ride of the doubloons"
"0","  distinct(IDD, V_Racenamef, .keep_all = TRUE) %>%"
"0","  # we join or database so that we always have the race of the name"
"0","  inner_join(df_V %>%"
"0","               mutate(IDD = paste0(ID, '_', V_Number, ""_"", V_Update)),"
"0","             by = ""IDD"")"
